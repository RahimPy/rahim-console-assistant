<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Console Auto Form</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a0e17 0%, #151a2d 100%);
            min-height: 100vh;
            padding: 40px;
        }
        
        .main-content {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(20, 25, 40, 0.9);
            border-radius: 16px;
            border: 1px solid rgba(66, 153, 225, 0.25);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        .main-header {
            background: linear-gradient(90deg, 
                rgba(30, 41, 59, 0.9) 0%, 
                rgba(66, 153, 225, 0.2) 50%,
                rgba(30, 41, 59, 0.9) 100%);
            padding: 25px 30px;
            border-bottom: 1px solid rgba(66, 153, 225, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-title {
            flex: 1;
        }
        
        .header-title h2 {
            color: #ffffff;
            font-size: 28px;
            margin-bottom: 5px;
            text-shadow: 0 2px 10px rgba(66, 153, 225, 0.3);
        }
        
        .header-title p {
            color: #90cdf4;
            font-size: 16px;
            opacity: 0.9;
        }
        
        .monkey-header {
            font-size: 40px;
            animation: bounce 1s infinite alternate;
            opacity: 1;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        .form-section {
            padding: 40px 30px;
            background: transparent;
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #90cdf4;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .required::after {
            content: " *";
            color: #ff3333;
            font-weight: bold;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid rgba(66, 153, 225, 0.3);
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s;
            background: rgba(30, 41, 59, 0.7) !important;
            color: #ffffff;
        }
        
        .form-group input::placeholder {
            color: #a0aec0;
        }
        
        .form-group select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2390cdf4' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 16px;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.2);
            background: rgba(30, 41, 59, 0.9) !important;
        }
        
        .form-selector {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .form-option {
            flex: 1;
            padding: 20px 15px;
            border: 1px solid rgba(66, 153, 225, 0.3);
            border-radius: 12px;
            background: rgba(30, 41, 59, 0.7);
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 15px rgba(66, 153, 225, 0.2);
        }
        
        .form-option:hover {
            border-color: rgba(66, 153, 225, 0.5);
            background: rgba(30, 41, 59, 0.9);
            box-shadow: 0 0 20px rgba(66, 153, 225, 0.3);
        }
        
        /* PASS ALL TESTS - Green glowing tick - ALWAYS GLOWING */
        .form-option[data-form="form3"] {
            order: 1;
            border-color: rgba(0, 204, 102, 0.3);
            box-shadow: 0 0 15px rgba(0, 204, 102, 0.2);
        }
        
        .form-option[data-form="form3"]:hover {
            border-color: rgba(0, 204, 102, 0.5);
            box-shadow: 0 0 20px rgba(0, 204, 102, 0.3);
        }
        
        .form-option[data-form="form3"].selected {
            border-color: #00cc66;
            background: linear-gradient(135deg, rgba(0, 204, 102, 0.15), rgba(30, 41, 59, 0.9));
            box-shadow: 0 0 25px rgba(0, 204, 102, 0.5);
            animation: greenGlow 2s infinite alternate;
        }
        
        @keyframes greenGlow {
            from {
                box-shadow: 0 0 15px rgba(0, 204, 102, 0.5);
            }
            to {
                box-shadow: 0 0 25px rgba(0, 204, 102, 0.7);
            }
        }
        
        /* FAILED TEST - Red X */
        .form-option[data-form="form1"] {
            order: 2;
            border-color: rgba(255, 51, 51, 0.3);
            box-shadow: 0 0 15px rgba(255, 51, 51, 0.2);
        }
        
        .form-option[data-form="form1"]:hover {
            border-color: rgba(255, 51, 51, 0.5);
            box-shadow: 0 0 20px rgba(255, 51, 51, 0.3);
        }
        
        .form-option[data-form="form1"].selected {
            border-color: #ff3333;
            background: linear-gradient(135deg, rgba(255, 51, 51, 0.15), rgba(30, 41, 59, 0.9));
            box-shadow: 0 0 25px rgba(255, 51, 51, 0.5);
            animation: redGlow 2s infinite alternate;
        }
        
        @keyframes redGlow {
            from {
                box-shadow: 0 0 15px rgba(255, 51, 51, 0.5);
            }
            to {
                box-shadow: 0 0 25px rgba(255, 51, 51, 0.7);
            }
        }
        
        /* REJECTION - Red circle (NO GLOW when selected) */
        .form-option[data-form="form2"] {
            order: 3;
            border-color: rgba(255, 51, 51, 0.3);
            box-shadow: 0 0 15px rgba(255, 51, 51, 0.2);
        }
        
        .form-option[data-form="form2"]:hover {
            border-color: rgba(255, 51, 51, 0.5);
            box-shadow: 0 0 20px rgba(255, 51, 51, 0.3);
        }
        
        .form-option[data-form="form2"].selected {
            border-color: #ff3333;
            background: linear-gradient(135deg, rgba(255, 51, 51, 0.15), rgba(30, 41, 59, 0.9));
            box-shadow: 0 0 15px rgba(255, 51, 51, 0.3); /* Reduced glow */
        }
        
        .form-option.selected::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            border-radius: 12px 12px 0 0;
        }
        
        .form-option[data-form="form1"].selected::before,
        .form-option[data-form="form2"].selected::before {
            background: linear-gradient(90deg, #ff3333, #ff6666);
        }
        
        .form-option[data-form="form3"].selected::before {
            background: linear-gradient(90deg, #00cc66, #66ff99);
        }
        
        .form-option .form-icon {
            font-size: 26px;
            margin-bottom: 8px;
            display: block;
            color: #90cdf4;
        }
        
        .form-option.selected .form-icon {
            color: #ffffff;
        }
        
        /* PASS ALL TESTS icon - Green glowing tick - ALWAYS GLOWING BRIGHT */
        .form-option[data-form="form3"] .form-icon {
            color: #00ff88;
            text-shadow: 0 0 15px rgba(0, 255, 136, 0.9);
            animation: greenTickGlowAlways 2s infinite alternate;
            font-size: 32px;
            font-weight: bold;
        }
        
        .form-option[data-form="form3"].selected .form-icon {
            color: #00ff88;
            text-shadow: 0 0 20px rgba(0, 255, 136, 1);
            animation: greenTickGlowSelected 2s infinite alternate;
        }
        
        @keyframes greenTickGlowAlways {
            from {
                text-shadow: 0 0 10px rgba(0, 255, 136, 0.8);
            }
            to {
                text-shadow: 0 0 20px rgba(0, 255, 136, 1);
            }
        }
        
        @keyframes greenTickGlowSelected {
            from {
                text-shadow: 0 0 15px rgba(0, 255, 136, 0.9);
            }
            to {
                text-shadow: 0 0 25px rgba(0, 255, 136, 1);
            }
        }
        
        /* FAILED TEST icon - Red X */
        .form-option[data-form="form1"] .form-icon {
            color: #ff3333;
        }
        
        .form-option[data-form="form1"].selected .form-icon {
            color: #ff6666;
            text-shadow: 0 0 10px rgba(255, 102, 102, 0.7);
            animation: xPulse 1.5s infinite alternate;
        }
        
        @keyframes xPulse {
            from {
                text-shadow: 0 0 5px rgba(255, 102, 102, 0.5);
            }
            to {
                text-shadow: 0 0 15px rgba(255, 102, 102, 0.9);
            }
        }
        
        /* REJECTION icon - Red circle */
        .form-option[data-form="form2"] .form-icon {
            color: #ff3333;
            font-size: 32px;
        }
        
        .form-option[data-form="form2"].selected .form-icon {
            color: #ff3333;
        }
        
        .form-option .form-name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 5px;
            color: #ffffff;
        }
        
        .form-option.selected .form-name {
            font-weight: 700;
        }
        
        .form-option[data-form="form1"] .form-name,
        .form-option[data-form="form2"] .form-name {
            color: #ff6666;
        }
        
        .form-option[data-form="form1"].selected .form-name,
        .form-option[data-form="form2"].selected .form-name {
            color: #ff9999;
            text-shadow: 0 0 5px rgba(255, 153, 153, 0.3);
        }
        
        .form-option[data-form="form3"] .form-name {
            color: #66ff99;
        }
        
        .form-option[data-form="form3"].selected .form-name {
            color: #99ffbb;
            text-shadow: 0 0 5px rgba(153, 255, 187, 0.3);
        }
        
        .form-option .form-desc {
            font-size: 12px;
            color: #a0aec0;
            line-height: 1.4;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .preview-box {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(66, 153, 225, 0.3);
            border-radius: 10px;
            padding: 16px;
            margin-top: 15px;
            font-size: 14px;
            color: #a0aec0;
        }
        
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 32px;
        }
        
        .btn {
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #00cc66, #00aa55);
            color: white;
            border: 1px solid rgba(0, 204, 102, 0.3);
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #00aa55, #008844);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 204, 102, 0.4);
        }
        
        .btn-clear {
            background: linear-gradient(135deg, #ff3333, #cc0000);
            color: white;
            border: 1px solid rgba(255, 51, 51, 0.3);
        }
        
        .btn-clear:hover {
            background: linear-gradient(135deg, #cc0000, #aa0000);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 51, 51, 0.4);
        }
        
        .success-message {
            background: rgba(0, 204, 102, 0.1);
            border: 1px solid rgba(0, 204, 102, 0.3);
            color: #66ff99;
            padding: 18px;
            border-radius: 10px;
            margin-top: 24px;
            display: none;
            text-align: center;
            font-size: 15px;
        }
        
        .not-testable-box {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-left: 4px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            color: #ffd54f;
            font-size: 14px;
            display: none;
        }
        
        .not-testable-title {
            color: #ffd700;
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .not-testable-list {
            list-style: none;
            margin: 5px 0 0 0;
            padding-left: 20px;
        }
        
        .not-testable-list li {
            margin-bottom: 5px;
            padding-left: 5px;
            position: relative;
            font-size: 13px;
        }
        
        .not-testable-list li:before {
            content: "‚Ä¢";
            color: #ffc107;
            font-size: 16px;
            position: absolute;
            left: -12px;
        }
        
        /* UPDATED HELP SECTION - Single column layout */
        .help-section {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.95));
            border-radius: 12px;
            padding: 30px;
            margin: 30px;
            border: 1px solid rgba(66, 153, 225, 0.3);
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(66, 153, 225, 0.15);
        }
        
        .help-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 12px;
            box-shadow: 
                inset 0 0 20px rgba(66, 153, 225, 0.1),
                inset 0 0 40px rgba(66, 153, 225, 0.05),
                0 0 60px rgba(66, 153, 225, 0.1);
            pointer-events: none;
            z-index: 1;
        }
        
        .help-card {
            background: rgba(20, 25, 40, 0.95);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid rgba(66, 153, 225, 0.3);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .help-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #4299e1, #90cdf4);
            border-radius: 12px 12px 0 0;
        }
        
        .help-card-title {
            color: #90cdf4;
            font-size: 1.4rem;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(66, 153, 225, 0.3);
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
        }
        
        .help-card-title i {
            font-size: 1.5rem;
            color: #4299e1;
        }
        
        /* UPDATED STEP BOX STYLES - Yellow headings, no arrows */
        .step-box {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(66, 153, 225, 0.3);
            transition: all 0.3s ease;
            border-left: 4px solid #4299e1;
        }
        
        .step-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(66, 153, 225, 0.2);
            border-color: #4299e1;
            background: rgba(30, 41, 59, 0.9);
        }
        
        .step-title {
            color: #ffd700;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .step-content {
            color: #cbd5e1;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        .step-highlight {
            background: rgba(66, 153, 225, 0.2);
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: #90cdf4;
        }
        
        .highlight-red {
            color: #ff6666 !important;
            font-weight: 600;
            background: transparent;
            padding: 0;
        }
        
        .highlight-green {
            color: #00cc66 !important;
            font-weight: 600;
            background: transparent;
            padding: 0;
        }
        
        .highlight-yellow {
            color: #ffd700 !important;
            font-weight: 600;
            background: transparent;
            padding: 0;
        }
        
        /* UPDATED KEYBOARD SHORTCUTS - Dark grey with glowing yellow text */
        .shortcuts-container {
            margin-top: 20px;
        }
        
        .shortcuts-header {
            color: #ffffff;
            font-size: 1.2rem;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(66, 153, 225, 0.3);
            font-weight: 600;
        }
        
        .shortcuts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }
        
        .shortcut-item {
            padding: 16px;
            border-radius: 10px;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(66, 153, 225, 0.3);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            min-height: 70px;
        }
        
        .shortcut-item:hover {
            background: rgba(30, 41, 59, 0.9);
            border-color: #4299e1;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .shortcut-item:hover .shortcut-key {
            background: #2a2d35;
            color: #ffd700;
            text-shadow: 0 0 15px rgba(255, 215, 0, 1);
            transform: scale(1.05);
        }
        
        .shortcut-key {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 50px;
            height: 40px;
            background: #3a3d45;
            color: #ffd700;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            flex-shrink: 0;
            padding: 0 12px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            animation: keyGlow 2s infinite alternate;
        }
        
        @keyframes keyGlow {
            from {
                text-shadow: 0 0 8px rgba(255, 215, 0, 0.7);
            }
            to {
                text-shadow: 0 0 12px rgba(255, 215, 0, 1);
            }
        }
        
        .shortcut-desc {
            color: #ffffff;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            line-height: 1.4;
            flex: 1;
        }
        
        .shortcut-combo {
            display: flex;
            align-items: center;
            gap: 5px;
            flex-shrink: 0;
        }
        
        .shortcut-combo .shortcut-key {
            min-width: 40px;
            height: 36px;
            font-size: 0.9rem;
        }
        
        .footer-signature {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            border-top: 1px solid rgba(66, 153, 225, 0.2);
        }
        
        .created-by {
            color: #ffffff;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .rahim-name {
            font-size: 26px;
            font-weight: 800;
            background: linear-gradient(
                90deg,
                #8a2be2,
                #9370db,
                #4169e1,
                #00bfff,
                #ffffff,
                #8a2be2
            );
            background-size: 400% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 8s ease infinite;
            padding: 5px 20px;
            border-radius: 10px;
            display: inline-block;
            text-shadow: 0 0 20px rgba(138, 43, 226, 0.5);
            letter-spacing: 1px;
        }
        
        .license-info {
            font-size: 0.8rem;
            color: #a0aec0;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(66, 153, 225, 0.2);
            line-height: 1.4;
        }
        
        .license-link {
            color: #90cdf4;
            text-decoration: none;
        }
        
        .license-link:hover {
            text-decoration: underline;
            color: #63b3ed;
        }
        
        .monkey-emojis {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .monkey {
            font-size: 24px;
            animation: bounce 1s infinite alternate;
        }
        
        .monkey:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .monkey:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes bounce {
            from {
                transform: translateY(0);
            }
            to {
                transform: translateY(-10px);
            }
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #4299e1 0%, #90cdf4 100%);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #3182ce 0%, #63b3ed 100%);
        }
        
        .dropdown-highlight {
            background-color: rgba(66, 153, 225, 0.2) !important;
            color: #90cdf4 !important;
        }
        
        /* Fix for dropdown infinite scrolling */
        select {
            max-height: 200px;
            overflow-y: auto;
        }
        
        select option {
            padding: 8px 12px;
            cursor: pointer;
        }
        
        select option:hover {
            background-color: rgba(66, 153, 225, 0.2);
        }
    </style>
</head>
<body>
    <div class="main-content">
        <div class="main-header">
            <div class="header-title">
                <h2>üéÆ Console Auto Form</h2>
                <p>Automated Console Form Generator</p>
            </div>
            <div class="monkey-header">üêµ</div>
        </div>
        
        <div class="form-section" autocomplete="off">
            <div class="form-group">
                <label class="required">SELECT FORM TYPE *</label>
                <div class="form-selector">
                    <!-- PASS ALL TESTS - First in order -->
                    <div class="form-option selected" onclick="selectForm('form3')" id="form3Option" data-form="form3">
                        <span class="form-icon">‚úì</span>
                        <div class="form-name">PASS ALL TESTS</div>
                        <div class="form-desc">All tests passed or not testable</div>
                    </div>
                    <!-- FAILED TEST - Second in order -->
                    <div class="form-option" onclick="selectForm('form1')" id="form1Option" data-form="form1">
                        <span class="form-icon">‚ùå</span>
                        <div class="form-name">FAILED TEST</div>
                        <div class="form-desc">Remaining tests after a failure are deemed not testable</div>
                    </div>
                    <!-- REJECTION - Third in order -->
                    <div class="form-option" onclick="selectForm('form2')" id="form2Option" data-form="form2">
                        <span class="form-icon">üî¥</span>
                        <div class="form-name">REJECTION</div>
                        <div class="form-desc">Single reason rejection</div>
                    </div>
                </div>
                <div class="preview-box" id="formPreview">
                    Currently selected: <strong style="color:#00cc66">PASS ALL TESTS</strong> ‚Äî All tests passed or not testable
                </div>
            </div>
            
            <div class="form-group">
                <div class="form-row">
                    <div>
                        <label class="required" for="item_id">ITEM ID *</label>
                        <input type="text" id="item_id" placeholder="Enter Item ID (e.g., 0012345)" autocomplete="off" maxlength="8">
                    </div>
                    <div>
                        <label class="required" for="serial">SERIAL NUMBER *</label>
                        <input type="text" id="serial" placeholder="Enter Serial Number" autocomplete="off">
                    </div>
                </div>
            </div>
            
            <div id="liveFormFields">
                <div class="form-group">
                    <label class="required" for="model">MODEL *</label>
                    <select id="model" autocomplete="off" onchange="updateNotTestableInfo()">
                        <option value="">Select Model</option>
                        <!-- Models populated from CONFIG -->
                    </select>
                </div>
                
                <div class="form-group" id="failureFields" style="display: none;">
                    <div class="form-row">
                        <div>
                            <label class="required" for="failure_point">FIRST FAILURE POINT *</label>
                            <select id="failure_point" onchange="updateFailureReasons()" autocomplete="off">
                                <option value="">Select where it first failed</option>
                                <!-- Failure points populated from CONFIG -->
                            </select>
                        </div>
                        <div>
                            <label class="required" for="failure_reason">FAILURE REASON *</label>
                            <select id="failure_reason" autocomplete="off">
                                <option value="">Select failure point first</option>
                            </select>
                        </div>
                    </div>
                    <div class="preview-box" id="previewBox">
                        Failure reason will be auto-filled based on your selection
                    </div>
                </div>
            </div>
            
            <div id="rejectionFormFields" style="display: none;">
                <div class="form-group">
                    <label class="required" for="rejection_reason">REJECTION REASON *</label>
                    <select id="rejection_reason" autocomplete="off">
                        <option value="">Select Rejection Reason</option>
                        <!-- Rejection reasons populated from CONFIG -->
                    </select>
                </div>
            </div>
            
            <div id="passAllFormFields">
                <div class="preview-box" style="background: rgba(0, 204, 102, 0.1); border-color: rgba(0, 204, 102, 0.3);">
                    <strong style="color: #00cc66;">‚úÖ PASS ALL TESTS MODE</strong><br>
                    All tests will be marked as "Passed" or "Not testable" based on console type.
                </div>
            </div>
            
            <div class="not-testable-box" id="notTestableBox">
                <div class="not-testable-title">
                    ‚ö†Ô∏è Tests marked as "Not testable" for this console:
                </div>
                <ul class="not-testable-list" id="notTestableList"></ul>
            </div>
            
            <div class="button-group">
                <button class="btn btn-success" onclick="generateAndOpenForm()">
                    <i class="fas fa-rocket"></i>
                    Open Form Now
                </button>
                <button class="btn btn-clear" onclick="clearForm()">
                    <i class="fas fa-eraser"></i>
                    Clear Form
                </button>
            </div>
            
            <div class="success-message" id="successMessage">
                ‚úÖ Form generated successfully!<br>
                <small>Form opened in new tab.</small>
            </div>
        </div>
        
        <!-- UPDATED HELP SECTION - Single column layout -->
        <div class="help-section">
            <div class="help-card">
                <div class="help-card-title">
                    <i class="fas fa-graduation-cap"></i>
                    HOW TO USE THIS TOOL
                </div>
                
                <div class="step-box">
                    <div class="step-title">Select Form Type</div>
                    <div class="step-content">
                        Choose between <span class="highlight-red">FAILED TEST</span> (remaining tests not testable), 
                        <span class="highlight-red">REJECTION</span> (single reason), or 
                        <span class="highlight-green">PASS ALL TESTS</span> (all tests passed or not testable).
                    </div>
                </div>
                
                <div class="step-box">
                    <div class="step-title">Enter Basic Information</div>
                    <div class="step-content">
                        Fill in the <span class="highlight-yellow">Item ID</span> (1-8 digits) and 
                        <span class="highlight-yellow">Serial Number</span> (both are required).
                    </div>
                </div>
                
                <div class="step-box">
                    <div class="step-title">For FAILED TEST Form Only</div>
                    <div class="step-content">
                        Select the <span class="highlight-yellow">Model</span>, then choose where it first failed and the specific failure reason.
                    </div>
                </div>
                
                <div class="step-box">
                    <div class="step-title">For REJECTION Form Only</div>
                    <div class="step-content">
                        Select a single rejection reason from the dropdown list.
                    </div>
                </div>
                
                <div class="step-box">
                    <div class="step-title">For PASS ALL TESTS Form</div>
                    <div class="step-content">
                        Just fill in Item ID, Serial Number, and Model - all tests will be marked as "Passed" or "Not testable" based on console type.
                    </div>
                </div>
                
                <div class="step-box">
                    <div class="step-title">Generate the Form</div>
                    <div class="step-content">
                        Click <span class="highlight-yellow">"Open Form Now"</span> - a new tab will open with the pre-filled form.
                    </div>
                </div>
                
                <!-- Keyboard Shortcuts in same card -->
                <div class="shortcuts-container">
                    <div class="shortcuts-header">Keyboard Shortcuts</div>
                    <div class="shortcuts-grid">
                        <div class="shortcut-item">
                            <div class="shortcut-key">F2</div>
                            <div class="shortcut-desc">Swap <span class="highlight-yellow">Item ID</span> & <span class="highlight-yellow">Serial Number</span></div>
                        </div>
                        
                        <div class="shortcut-item">
                            <div class="shortcut-key">Ctrl + 1</div>
                            <div class="shortcut-desc">Switch to <span class="highlight-red">FAILED TEST</span> form</div>
                        </div>
                        
                        <div class="shortcut-item">
                            <div class="shortcut-key">Ctrl + 2</div>
                            <div class="shortcut-desc">Switch to <span class="highlight-red">REJECTION</span> form</div>
                        </div>
                        
                        <div class="shortcut-item">
                            <div class="shortcut-key">Ctrl + 3</div>
                            <div class="shortcut-desc">Switch to <span class="highlight-green">PASS ALL TESTS</span> form</div>
                        </div>
                        
                        <div class="shortcut-item">
                            <div class="shortcut-combo">
                                <div class="shortcut-key">Ctrl</div>
                                <div style="color: #ffffff;">+</div>
                                <div class="shortcut-key">Enter</div>
                            </div>
                            <div class="shortcut-desc">Generate and open form</div>
                        </div>
                        
                        <div class="shortcut-item">
                            <div class="shortcut-key">Esc</div>
                            <div class="shortcut-desc">Clear all form fields</div>
                        </div>
                        
                        <div class="shortcut-item">
                            <div class="shortcut-key">Tab</div>
                            <div class="shortcut-desc">Navigate between fields</div>
                        </div>
                        
                        <div class="shortcut-item">
                            <div class="shortcut-key" style="min-width: 100px; font-size: 0.85rem;">Type in dropdown</div>
                            <div class="shortcut-desc">Jump to matching option</div>
                        </div>
                        
                        <div class="shortcut-item">
                            <div class="shortcut-key">Enter</div>
                            <div class="shortcut-desc">Submit or move to next field</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer-signature">
            <div class="monkey-emojis">
                <div class="monkey">üôà</div>
                <div class="monkey">üôâ</div>
                <div class="monkey">üôä</div>
            </div>
            <div class="created-by">Created by</div>
            <div class="rahim-name">RAHIM</div>
            
            <div class="license-info">
                MIT License &copy; 2025<br>
                Permission is hereby granted, free of charge, to any person obtaining a copy
                of this software and associated documentation files (the "Software"), to deal
                in the Software without restriction, including without limitation the rights
                to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
                copies of the Software, and to permit persons to whom the Software is
                furnished to do so, subject to the following conditions:<br><br>
                
                The above copyright notice and this permission notice shall be included in all
                copies or substantial portions of the Software.<br><br>
                
                THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
                IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
                FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
                AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
                LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
                OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
                <br><br>
                <a href="https://github.com/alexrodriguez/console-auto-form" class="license-link" target="_blank">View on GitHub</a>
            </div>
        </div>
    </div>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        // ================= CONFIGURATION SECTION =================
        const CONFIG = {
            // Google Form URLs
            GOOGLE_FORMS: {
                FAILED_TEST: "https://docs.google.com/forms/d/e/1FAIpQLSdw_dydIgIk2lDK02LYyfi-4ytC5i7EEcjwCBV-t2qmcRU-aQ/viewform?pli=1&pli=1",
                REJECTION: "https://docs.google.com/forms/d/e/1FAIpQLSfBIRKz7rHYnRKip_CinYR1dPN7lUkor1B3goSxDQdrdktJ5g/viewform",
                PASS_ALL: "https://docs.google.com/forms/d/e/1FAIpQLSdw_dydIgIk2lDK02LYyfi-4ytC5i7EEcjwCBV-t2qmcRU-aQ/viewform?pli=1&pli=1"
            },
            
            // Google Form Field IDs
            FIELD_IDS: {
                FAILED_TEST: {
                    item_id: "entry.264714925",
                    serial: "entry.1467120290",
                    model: "entry.1645409711",
                    auth: "entry.1389653337",
                    boot: "entry.582532298",
                    buttons: "entry.1182612584",
                    jailbreak: "entry.496249149",
                    network: "entry.515652933",
                    accounts: "entry.1245600276",
                    ports: "entry.2000355850",
                    disc_storage: "entry.1981842962",
                    battery: "entry.1201219719",
                    display: "entry.373626164",
                    speaker_mic: "entry.1064347633",
                    load: "entry.261682137",
                    noise_smell: "entry.165249102",
                    controller: "entry.23953354",
                    accessories: "entry.926040436",
                    auth_why: "entry.1882150640",
                    boot_why: "entry.1965271608",
                    buttons_why: "entry.1567705433",
                    jailbreak_why: "entry.2116645276",
                    network_why: "entry.1387611846",
                    accounts_why: "entry.1009950602",
                    ports_why: "entry.910771481",
                    disc_storage_why: "entry.198376670",
                    battery_why: "entry.91471292",
                    display_why: "entry.876337039",
                    speaker_mic_why: "entry.728090706",
                    load_why: "entry.1847751109",
                    noise_smell_why: "entry.1095686758",
                    controller_why: "entry.570841000",
                    accessories_why: "entry.764500531",
                    general: "entry.382102081"
                },
                REJECTION: {
                    item_id: "entry.264714925",
                    serial: "entry.1215422911",
                    rejection_reason: "entry.1263436854",
                    general: "entry.382102081"
                }
            },
            
            // Console Models (Alphabetical) - device not supported moved to bottom
            PASS_ALL_MODELS: [
                "Asus ROG Ally (2023)",
                "Asus ROG Ally X (2024)",
                "Lenovo Legion Go",
                "New Nintendo 2DS XL",
                "New Nintendo 3DS",
                "New Nintendo 3DS XL",
                "Nintendo 2DS (Original)",
                "Nintendo 3DS (Original)",
                "Nintendo 3DS XL",
                "Nintendo 64 (Original)",
                "Nintendo DS",
                "Nintendo DSi",
                "Nintendo DSi XL",
                "Nintendo Game Boy",
                "Nintendo Game Boy Advance",
                "Nintendo Switch",
                "Nintendo Switch Lite",
                "Nintendo Switch 2",
                "Nintendo Wii",
                "Nintendo Wii U",
                "PlayStation 1",
                "PlayStation 2",
                "PlayStation 3",
                "PlayStation 4",
                "PlayStation 4 pro",
                "PlayStation 4 slim",
                "PlayStation 5",
                "PlayStation 5 digital",
                "PlayStation 5 pro",
                "PlayStation Portal 2025",
                "PlayStation Portable",
                "PlayStation Vita",
                "Steam Deck",
                "Xbox (original)",
                "Xbox 360",
                "Xbox One (Original)",
                "Xbox One S",
                "Xbox One X",
                "Xbox Series S",
                "Xbox Series X",
                "device not supported"
            ],
            
            // Console Models for other forms (without Nintendo Switch Lite)
            OTHER_MODELS: [
                "Asus ROG Ally (2023)",
                "Asus ROG Ally X (2024)",
                "Lenovo Legion Go",
                "New Nintendo 2DS XL",
                "New Nintendo 3DS",
                "New Nintendo 3DS XL",
                "Nintendo 2DS (Original)",
                "Nintendo 3DS (Original)",
                "Nintendo 3DS XL",
                "Nintendo 64 (Original)",
                "Nintendo DS",
                "Nintendo DSi",
                "Nintendo DSi XL",
                "Nintendo Game Boy",
                "Nintendo Game Boy Advance",
                "Nintendo Switch",
                "Nintendo Switch 2",
                "Nintendo Wii",
                "Nintendo Wii U",
                "PlayStation 1",
                "PlayStation 2",
                "PlayStation 3",
                "PlayStation 4",
                "PlayStation 4 pro",
                "PlayStation 4 slim",
                "PlayStation 5",
                "PlayStation 5 digital",
                "PlayStation 5 pro",
                "PlayStation Portal 2025",
                "PlayStation Portable",
                "PlayStation Vita",
                "Steam Deck",
                "Xbox (original)",
                "Xbox 360",
                "Xbox One (Original)",
                "Xbox One S",
                "Xbox One X",
                "Xbox Series S",
                "Xbox Series X",
                "device not supported"
            ],
            
            // Failure Points (Alphabetical)
            FAILURE_POINTS: [
                "Accounts check",
                "Accessories",
                "Authenticity check",
                "Battery test",
                "Buttons test",
                "Controller test (incl. vibration)",
                "Disc drive and storage test",
                "Display test",
                "Jailbreak test",
                "Load test",
                "Network connections test",
                "Noise and smell test",
                "Ports test",
                "Powering on and booting up",
                "Speaker and microphone test"
            ],
            
            // Failure Reasons (Alphabetical within categories)
            FAILURE_REASONS: {
                "Accounts check": [
                    "Blacklisted Device",
                    "Locked Device",
                    "Other"
                ],
                "Accessories": [
                    "Camera issues",
                    "Critical accessory issues",
                    "Flash issues",
                    "Other"
                ],
                "Authenticity check": [
                    "Likely counterfeit device",
                    "Likely nongenuine parts",
                    "Other",
                    "Seal issues"
                ],
                "Battery test": [
                    "Battery issues",
                    "Does not charge",
                    "Other",
                    "Safety issues",
                    "Swollen battery"
                ],
                "Buttons test": [
                    "Button issues",
                    "Other"
                ],
                "Controller test (incl. vibration)": [
                    "Controller issues",
                    "Other",
                    "Vibration issues"
                ],
                "Disc drive and storage test": [
                    "Disc drive issues",
                    "Other",
                    "SD card issues",
                    "Storage device issues"
                ],
                "Display test": [
                    "Other",
                    "Screen issues"
                ],
                "Jailbreak test": [
                    "Jailbroken or rooted device",
                    "Other"
                ],
                "Load test": [
                    "Game load issues",
                    "Other",
                    "Sensor issues"
                ],
                "Network connections test": [
                    "Bluetooth issues",
                    "Ethernet issues",
                    "NFC issues",
                    "Other",
                    "WiFi issues"
                ],
                "Noise and smell test": [
                    "Defective Fan",
                    "Heat issues",
                    "Other",
                    "Smell issues (burning smell,broken capacitors)"
                ],
                "Ports test": [
                    "HDMI issues",
                    "Other",
                    "Port issues",
                    "USB issues",
                    "Video signal errors"
                ],
                "Powering on and booting up": [
                    "Charging failure",
                    "Liquid damaged device",
                    "Not starting",
                    "Other",
                    "Short circuiting device",
                    "Software error",
                    "Video signal errors",
                    "Wireless charging failure"
                ],
                "Speaker and microphone test": [
                    "Microphone issues",
                    "Other",
                    "Speaker issues"
                ]
            },
            
            // Rejection Reasons (Alphabetical)
            REJECTION_REASONS: [
                "ARRIVED_DAMAGED",
                "BLACKLISTED_DEVICE",
                "BROKEN_SEAL",
                "CONSOLE_ACCESSORY_ISSUES",
                "CONTROLLER_ISSUES",
                "CRITICAL_ACCESSORY_ISSUES",
                "CRITICAL_CONDITION_MISMATCH",
                "DAMAGED_IN_WAREHOUSE",
                "DISC_DRIVE_ISSUES",
                "EMPTY_PARCEL",
                "JAIL_BROKEN_OR_ROOTED",
                "LIQUID_DAMAGE",
                "LIKELY_COUNTERFEIT_DEVICE",
                "LOCKED_DEVICE",
                "MULTIPLE_ITEMS",
                "NOT_STARTING",
                "SAFETY_ISSUES",
                "SEAL_ISSUES",
                "SOFTWARE_ISSUES",
                "SWOLLEN_BATTERY",
                "UNSUPPORTED_DEVICE",
                "WRONG_ITEM",
                "WRONG_MODEL",
                "WRONG_SPECIFICATIONS",
                "WRONG_STORAGE_CAPACITY"
            ]
        };

        // ================= CONSTANTS =================
        const CONSTANTS = {
            // Test order for cascade logic
            TESTS: ["auth", "boot", "buttons", "jailbreak", "network", "accounts", "ports", "disc_storage", "battery", "display", "speaker_mic", "load", "noise_smell", "controller", "accessories"],
            
            // Special console rules - ADDED Nintendo Switch Lite and Xbox (original)
            SPECIAL_CONSOLES: {
                "PlayStation 3": ["battery", "display", "speaker_mic"],
                "PlayStation 4": ["battery", "display", "speaker_mic"],
                "PlayStation 4 slim": ["battery", "display", "speaker_mic"],
                "PlayStation 4 pro": ["battery", "display", "speaker_mic"],
                "PlayStation 5": ["battery", "display", "speaker_mic"],
                "PlayStation 5 digital": ["battery", "display", "speaker_mic", "disc_storage"],
                "PlayStation 5 pro": ["battery", "display", "speaker_mic"],
                "Xbox One (Original)": ["battery", "display", "speaker_mic"],
                "Xbox One S": ["battery", "display", "speaker_mic"],
                "Xbox One X": ["battery", "display", "speaker_mic"],
                "Xbox Series X": ["battery", "display", "speaker_mic"],
                "Xbox 360": ["battery", "display", "speaker_mic"],
                "Xbox Series S": ["battery", "display", "speaker_mic", "disc_storage"],
                "Xbox (original)": ["network", "accounts", "battery", "display", "speaker_mic"],
                "PlayStation Portable": ["controller"],
                "PlayStation Portal 2025": ["disc_storage", "load"],
                "PlayStation Vita": ["controller"],
                "Nintendo DS": ["network", "accounts", "controller"],
                "Nintendo 2DS (Original)": ["controller"],
                "Nintendo 3DS (Original)": ["controller"],
                "Nintendo 3DS XL": ["controller"],
                "New Nintendo 3DS": ["controller"],
                "New Nintendo 3DS XL": ["controller"],
                "New Nintendo 2DS XL": ["controller"],
                "Nintendo DSi": ["controller"],
                "Nintendo DSi XL": ["controller"],
                "Nintendo Wii": ["display", "speaker_mic", "battery"],
                "Nintendo 64 (Original)": ["network", "accounts", "battery", "speaker_mic", "display"],
                "PlayStation 1": ["network", "accounts", "battery", "speaker_mic", "display"],
                "PlayStation 2": ["network", "accounts", "battery", "speaker_mic", "display"],
                "Nintendo Switch Lite": ["controller"]
            },
            
            // Keyboard shortcuts
            KEYBOARD_SHORTCUTS: {
                "Ctrl+Enter": "generateAndOpenForm",
                "Ctrl+1": "selectForm('form1')",
                "Ctrl+2": "selectForm('form2')",
                "Ctrl+3": "selectForm('form3')",
                "F2": "swapIdSerial",
                "Escape": "clearForm"
            }
        };

        // ================= RUNTIME VARIABLES =================
        let CURRENT_FORM = 'form3';
        let currentFieldIds = CONFIG.FIELD_IDS.FAILED_TEST;
        let lastF2Time = 0;
        let currentSearchChar = '';
        let searchTimeout = null;

        // ================= INITIALIZATION =================
        document.addEventListener('DOMContentLoaded', function() {
            populateDropdowns();
            setupAutoNavigation();
            setupTypeAheadSearch();
            setupKeyboardShortcuts();
            selectForm('form3');
            document.getElementById('item_id').focus();
            
            fixDropdownScrolling();
        });

        // Fix dropdown infinite scrolling
        function fixDropdownScrolling() {
            const dropdowns = ['model', 'failure_point', 'failure_reason', 'rejection_reason'];
            
            dropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (dropdown) {
                    dropdown.addEventListener('wheel', function(e) {
                        if (this.hasAttribute('multiple')) {
                            return;
                        }
                        e.preventDefault();
                    }, { passive: false });
                    
                    dropdown.addEventListener('focus', function() {
                        this.style.overflowY = 'auto';
                        this.style.maxHeight = '200px';
                    });
                    
                    dropdown.addEventListener('blur', function() {
                        this.style.overflowY = '';
                        this.style.maxHeight = '';
                    });
                }
            });
        }

        // ================= DROPDOWN FUNCTIONS =================
        function populateDropdowns() {
            const modelSelect = document.getElementById('model');
            
            modelSelect.innerHTML = '<option value="">Select Model</option>';
            
            let modelsToUse;
            if (CURRENT_FORM === 'form3') {
                modelsToUse = CONFIG.PASS_ALL_MODELS;
            } else {
                modelsToUse = CONFIG.OTHER_MODELS;
            }
            
            modelsToUse.forEach(model => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = model;
                modelSelect.appendChild(option);
            });
            
            const failurePointSelect = document.getElementById('failure_point');
            failurePointSelect.innerHTML = '<option value="">Select where it first failed</option>';
            CONFIG.FAILURE_POINTS.forEach(point => {
                const option = document.createElement('option');
                option.value = getFailurePointKey(point);
                option.textContent = point;
                failurePointSelect.appendChild(option);
            });
            
            const rejectionSelect = document.getElementById('rejection_reason');
            rejectionSelect.innerHTML = '<option value="">Select Rejection Reason</option>';
            CONFIG.REJECTION_REASONS.forEach(reason => {
                const option = document.createElement('option');
                option.value = reason;
                option.textContent = reason;
                rejectionSelect.appendChild(option);
            });
        }
        
        function getFailurePointKey(displayName) {
            const mapping = {
                "Accounts check": "accounts",
                "Accessories": "accessories",
                "Authenticity check": "auth",
                "Battery test": "battery",
                "Buttons test": "buttons",
                "Controller test (incl. vibration)": "controller",
                "Disc drive and storage test": "disc_storage",
                "Display test": "display",
                "Jailbreak test": "jailbreak",
                "Load test": "load",
                "Network connections test": "network",
                "Noise and smell test": "noise_smell",
                "Ports test": "ports",
                "Powering on and booting up": "boot",
                "Speaker and microphone test": "speaker_mic"
            };
            return mapping[displayName] || displayName.toLowerCase().replace(/[^a-z]/g, '_');
        }

        function setupTypeAheadSearch() {
            const dropdowns = ['model', 'failure_point', 'failure_reason', 'rejection_reason'];
            
            dropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (!dropdown) return;
                
                dropdown.addEventListener('keydown', function(e) {
                    if (searchTimeout) {
                        clearTimeout(searchTimeout);
                    }
                    
                    if (e.key.length === 1 && /[a-zA-Z0-9 ]/.test(e.key)) {
                        e.preventDefault();
                        
                        currentSearchChar += e.key.toLowerCase();
                        
                        highlightMatchingOption(this, currentSearchChar);
                        
                        searchTimeout = setTimeout(() => {
                            currentSearchChar = '';
                        }, 1000);
                    }
                });
            });
        }
        
        function highlightMatchingOption(dropdown, searchTerm) {
            const options = Array.from(dropdown.options);
            let foundIndex = -1;
            
            options.forEach(opt => opt.classList.remove('dropdown-highlight'));
            
            for (let i = 0; i < options.length; i++) {
                if (options[i].text.toLowerCase().includes(searchTerm)) {
                    foundIndex = i;
                    options[i].classList.add('dropdown-highlight');
                    dropdown.selectedIndex = i;
                    
                    const optionHeight = 30;
                    dropdown.scrollTop = i * optionHeight;
                    break;
                }
            }
        }

        // ================= FORM FUNCTIONS =================
        function selectForm(formId) {
            CURRENT_FORM = formId;
            currentFieldIds = formId === 'form2' ? CONFIG.FIELD_IDS.REJECTION : CONFIG.FIELD_IDS.FAILED_TEST;
            
            document.getElementById('form1Option').classList.remove('selected');
            document.getElementById('form2Option').classList.remove('selected');
            document.getElementById('form3Option').classList.remove('selected');
            document.getElementById(formId + 'Option').classList.add('selected');
            
            if (formId === 'form1') {
                document.getElementById('formPreview').innerHTML = 
                    'Currently selected: <strong style="color:#ff3333">FAILED TEST</strong> ‚Äî Remaining tests after a failure are deemed not testable';
            } else if (formId === 'form2') {
                document.getElementById('formPreview').innerHTML = 
                    'Currently selected: <strong style="color:#ff3333">REJECTION</strong> ‚Äî Single reason rejection';
            } else if (formId === 'form3') {
                document.getElementById('formPreview').innerHTML = 
                    'Currently selected: <strong style="color:#00cc66">PASS ALL TESTS</strong> ‚Äî All tests passed or not testable';
            }
            
            if (formId === 'form1') {
                document.getElementById('liveFormFields').style.display = 'block';
                document.getElementById('rejectionFormFields').style.display = 'none';
                document.getElementById('passAllFormFields').style.display = 'none';
                document.getElementById('notTestableBox').style.display = 'none';
                document.getElementById('failureFields').style.display = 'block';
                
            } else if (formId === 'form2') {
                document.getElementById('liveFormFields').style.display = 'none';
                document.getElementById('rejectionFormFields').style.display = 'block';
                document.getElementById('passAllFormFields').style.display = 'none';
                document.getElementById('notTestableBox').style.display = 'none';
                
            } else if (formId === 'form3') {
                document.getElementById('liveFormFields').style.display = 'block';
                document.getElementById('rejectionFormFields').style.display = 'none';
                document.getElementById('passAllFormFields').style.display = 'block';
                document.getElementById('failureFields').style.display = 'none';
                
                const model = document.getElementById('model').value;
                if (model) {
                    updateNotTestableInfo();
                }
            }
            
            populateDropdowns();
            
            const currentModel = document.getElementById('model').value;
            if (currentModel && 
                ((formId === 'form3' && CONFIG.PASS_ALL_MODELS.includes(currentModel)) ||
                 (formId !== 'form3' && CONFIG.OTHER_MODELS.includes(currentModel)))) {
                document.getElementById('model').value = currentModel;
            } else {
                document.getElementById('model').value = '';
            }
        }

        function updateFailureReasons() {
            const failurePoint = document.getElementById('failure_point').value;
            const reasonSelect = document.getElementById('failure_reason');
            
            reasonSelect.innerHTML = '<option value="">Select Failure Reason</option>';
            
            if (!failurePoint) return;
            
            const pointName = CONFIG.FAILURE_POINTS.find(p => getFailurePointKey(p) === failurePoint);
            const reasons = CONFIG.FAILURE_REASONS[pointName] || ["Other"];
            
            reasons.forEach(reason => {
                const option = document.createElement('option');
                option.value = reason;
                option.textContent = reason;
                reasonSelect.appendChild(option);
            });
        }

        function updateNotTestableInfo() {
            const model = document.getElementById('model').value;
            const notTestableBox = document.getElementById('notTestableBox');
            const notTestableList = document.getElementById('notTestableList');
            
            notTestableList.innerHTML = '';
            
            if (CURRENT_FORM !== 'form3') {
                notTestableBox.style.display = 'none';
                return;
            }
            
            if (!model) {
                notTestableBox.style.display = 'none';
                return;
            }
            
            const specialTests = CONSTANTS.SPECIAL_CONSOLES[model];
            
            if (specialTests && specialTests.length > 0) {
                notTestableBox.style.display = 'block';
                
                specialTests.forEach(test => {
                    const li = document.createElement('li');
                    li.textContent = getTestDisplayName(test);
                    notTestableList.appendChild(li);
                });
            } else {
                notTestableBox.style.display = 'none';
            }
        }
        
        function getTestDisplayName(testKey) {
            const testNames = {
                "auth": "Authenticity check",
                "boot": "Powering on and booting up",
                "buttons": "Buttons test",
                "jailbreak": "Jailbreak test",
                "network": "Network connections test",
                "accounts": "Accounts check",
                "ports": "Ports test",
                "disc_storage": "Disc drive and storage test",
                "battery": "Battery test",
                "display": "Display test",
                "speaker_mic": "Speaker and microphone test",
                "load": "Load test",
                "noise_smell": "Noise and smell test",
                "controller": "Controller test",
                "accessories": "Accessories test"
            };
            return testNames[testKey] || testKey;
        }

        // ================= NAVIGATION FUNCTIONS =================
        function setupAutoNavigation() {
            document.getElementById('item_id').addEventListener('input', function() {
                const value = this.value.replace(/\t/g, '');
                if (value !== this.value) {
                    this.value = value;
                }
                
                if (value.length === 8) {
                    setTimeout(() => {
                        document.getElementById('serial').focus();
                    }, 50);
                }
            });

            document.getElementById('serial').addEventListener('input', function() {
                const value = this.value.replace(/\t/g, '');
                if (value !== this.value) {
                    this.value = value;
                }
                
                if (value.length > 0) {
                    setTimeout(() => {
                        if (CURRENT_FORM === 'form1' || CURRENT_FORM === 'form3') {
                            document.getElementById('model').focus();
                        } else if (CURRENT_FORM === 'form2') {
                            document.getElementById('rejection_reason').focus();
                        }
                    }, 50);
                }
            });

            document.getElementById('model').addEventListener('change', function() {
                if (this.value) {
                    setTimeout(() => {
                        if (CURRENT_FORM === 'form1') {
                            document.getElementById('failure_point').focus();
                        } else if (CURRENT_FORM === 'form3') {
                            document.querySelector('.btn-success').focus();
                        }
                    }, 50);
                }
            });

            document.getElementById('failure_point').addEventListener('change', function() {
                if (CURRENT_FORM === 'form1' && this.value) {
                    updateFailureReasons();
                    setTimeout(() => {
                        document.getElementById('failure_reason').focus();
                    }, 50);
                }
            });

            document.getElementById('failure_reason').addEventListener('change', function() {
                if (CURRENT_FORM === 'form1' && this.value) {
                    setTimeout(() => {
                        document.querySelector('.btn-success').focus();
                    }, 50);
                }
            });

            document.getElementById('rejection_reason').addEventListener('change', function() {
                if (CURRENT_FORM === 'form2' && this.value) {
                    setTimeout(() => {
                        document.querySelector('.btn-success').focus();
                    }, 50);
                }
            });

            document.getElementById('item_id').addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    e.preventDefault();
                    const cleanValue = this.value.replace(/\t/g, '').substring(0, 8);
                    this.value = cleanValue;
                    document.getElementById('serial').focus();
                }
            });

            document.getElementById('serial').addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    e.preventDefault();
                    const cleanValue = this.value.replace(/\t/g, '');
                    this.value = cleanValue;
                    if (CURRENT_FORM === 'form1' || CURRENT_FORM === 'form3') {
                        document.getElementById('model').focus();
                    } else if (CURRENT_FORM === 'form2') {
                        document.getElementById('rejection_reason').focus();
                    }
                }
            });
        }

        // ================= FORM GENERATION FUNCTIONS =================
        function collectFormData() {
            const itemId = sanitizeInput(document.getElementById('item_id').value.trim());
            const serial = sanitizeInput(document.getElementById('serial').value.trim());
            
            if (!/^\d{1,8}$/.test(itemId)) {
                alert("‚ùå Item ID must be 1-8 digits (numbers only)");
                return null;
            }
            
            if (!itemId || !serial) {
                alert("‚ùå Please fill Item ID and Serial Number");
                return null;
            }
            
            const formData = {
                formType: CURRENT_FORM,
                itemId: itemId,
                serial: serial
            };
            
            if (CURRENT_FORM === 'form1' || CURRENT_FORM === 'form3') {
                const model = document.getElementById('model').value;
                
                if (!model) {
                    alert("‚ùå Please select Model");
                    return null;
                }
                
                formData.model = (model === "Nintendo Switch Lite") ? "Nintendo Switch" : model;
                formData.originalModel = model;
                
                if (CURRENT_FORM === 'form1') {
                    const failurePoint = document.getElementById('failure_point').value;
                    const failureReason = document.getElementById('failure_reason').value;
                    
                    if (!failurePoint) {
                        alert("‚ùå Please select Failure Point for FAILED TEST form");
                        return null;
                    }
                    
                    formData.failurePoint = failurePoint;
                    formData.failureReason = failureReason || "Other";
                }
                
            } else if (CURRENT_FORM === 'form2') {
                const rejectionReason = document.getElementById('rejection_reason').value;
                
                if (!rejectionReason) {
                    alert("‚ùå Please select a rejection reason");
                    return null;
                }
                
                formData.rejectionReason = rejectionReason;
            }
            
            return formData;
        }

        function generateAndOpenForm() {
            const formData = collectFormData();
            if (!formData) return;
            
            const url = generateFormURL(formData);
            
            if (!validateGoogleFormUrl(url)) {
                alert("‚ö†Ô∏è Invalid form URL. Please check configuration.");
                return;
            }
            
            if (url && url !== "#") {
                window.open(url, '_blank');
                
                const successMsg = document.getElementById('successMessage');
                successMsg.style.display = 'block';
                setTimeout(() => {
                    successMsg.style.display = 'none';
                }, 3000);
                
                clearForm();
            }
        }

        function generateFormURL(formData) {
            let baseUrl, fieldIds;
            
            if (formData.formType === 'form1') {
                baseUrl = CONFIG.GOOGLE_FORMS.FAILED_TEST;
                fieldIds = CONFIG.FIELD_IDS.FAILED_TEST;
            } else if (formData.formType === 'form2') {
                baseUrl = CONFIG.GOOGLE_FORMS.REJECTION;
                fieldIds = CONFIG.FIELD_IDS.REJECTION;
            } else {
                baseUrl = CONFIG.GOOGLE_FORMS.PASS_ALL;
                fieldIds = CONFIG.FIELD_IDS.FAILED_TEST;
            }
            
            if (!baseUrl) return "#";
            
            let url = baseUrl + (baseUrl.includes('?') ? '&' : '?');
            let params = [];
            
            if (formData.formType === 'form1') {
                params.push(fieldIds.item_id + "=" + encodeURIComponent(formData.itemId));
                params.push(fieldIds.serial + "=" + encodeURIComponent(formData.serial));
                
                if (formData.model) {
                    params.push(fieldIds.model + "=" + encodeURIComponent(formData.model));
                }
                
                let failed = false;
                CONSTANTS.TESTS.forEach(test => {
                    if (failed) {
                        params.push(fieldIds[test] + "=" + encodeURIComponent("Not testable"));
                    } else if (test === formData.failurePoint) {
                        params.push(fieldIds[test] + "=" + encodeURIComponent("Failed"));
                        failed = true;
                    } else {
                        params.push(fieldIds[test] + "=" + encodeURIComponent("Passed"));
                    }
                });
                
                if (formData.failurePoint && formData.failureReason) {
                    const whyField = fieldIds[formData.failurePoint + "_why"];
                    if (whyField) {
                        params.push(whyField + "=" + encodeURIComponent(formData.failureReason || "Other"));
                    }
                }
                
                params.push(fieldIds.general + "=" + encodeURIComponent("failed"));
                
            } else if (formData.formType === 'form2') {
                params.push(fieldIds.item_id + "=" + encodeURIComponent(formData.itemId));
                params.push(fieldIds.serial + "=" + encodeURIComponent(formData.serial));
                
                if (formData.rejectionReason) {
                    params.push(fieldIds.rejection_reason + "=" + encodeURIComponent(formData.rejectionReason));
                }
                
                params.push(fieldIds.general + "=" + encodeURIComponent("failed"));
                
            } else if (formData.formType === 'form3') {
                params.push(fieldIds.item_id + "=" + encodeURIComponent(formData.itemId));
                params.push(fieldIds.serial + "=" + encodeURIComponent(formData.serial));
                
                if (formData.model) {
                    params.push(fieldIds.model + "=" + encodeURIComponent(formData.model));
                }
                
                const modelForLogic = formData.originalModel || formData.model;
                
                CONSTANTS.TESTS.forEach(test => {
                    if (CONSTANTS.SPECIAL_CONSOLES[modelForLogic] && 
                        CONSTANTS.SPECIAL_CONSOLES[modelForLogic].includes(test)) {
                        params.push(fieldIds[test] + "=" + encodeURIComponent("Not testable"));
                    } else {
                        params.push(fieldIds[test] + "=" + encodeURIComponent("Passed"));
                    }
                });
                
                params.push(fieldIds.general + "=" + encodeURIComponent("passed"));
            }
            
            url += params.join('&');
            url = url.replace(/[&?]+$/, '');
            
            return url;
        }

        // ================= UTILITY FUNCTIONS =================
        function sanitizeInput(input) {
            return input
                .replace(/[\r\n\t]/g, '')
                .replace(/[<>"'&]/g, '')
                .substring(0, 50);
        }

        function validateGoogleFormUrl(url) {
            const googleFormRegex = /^https:\/\/docs\.google\.com\/forms\/d\/e\/[A-Za-z0-9_-]+\/.*$/;
            return googleFormRegex.test(url);
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    e.preventDefault();
                    generateAndOpenForm();
                    return;
                }
                if (e.ctrlKey && e.key === '1') {
                    e.preventDefault();
                    selectForm('form1');
                    return;
                }
                if (e.ctrlKey && e.key === '2') {
                    e.preventDefault();
                    selectForm('form2');
                    return;
                }
                if (e.ctrlKey && e.key === '3') {
                    e.preventDefault();
                    selectForm('form3');
                    return;
                }
                if (e.key === 'F2') {
                    e.preventDefault();
                    const now = Date.now();
                    if (now - lastF2Time > 500) {
                        swapIdSerial();
                        lastF2Time = now;
                    }
                    return;
                }
                if (e.key === 'Escape') {
                    clearForm();
                    return;
                }
            });
        }

        function swapIdSerial() {
            const itemId = document.getElementById('item_id');
            const serial = document.getElementById('serial');
            
            const temp = itemId.value;
            itemId.value = serial.value;
            serial.value = temp;
        }

        function clearForm() {
            document.getElementById('item_id').value = '';
            document.getElementById('serial').value = '';
            document.getElementById('model').value = '';
            document.getElementById('failure_point').value = '';
            document.getElementById('failure_reason').value = '';
            document.getElementById('rejection_reason').value = '';
            
            document.getElementById('notTestableBox').style.display = 'none';
            
            document.getElementById('item_id').focus();
        }
    </script>
</body>
</html>
